---
output: github_document
---

# yaf <img src="man/figures/logo.png" align="right" height="139" />

Пакет `yaf` (Yandex Direct API Functions) предназначен для простой и быстрой выгрузки статистики из API Яндекс.Директа напрямую в R. Пакет берет на себя все сложности с авторизацией, обработкой JSON-ответов и автоматическим преобразованием типов данных.

## Требования

Для стабильной работы пакета вам понадобятся:
* **R** версии 4.1.0 или выше (пакет использует нативный пайп `|>`).
* **RStudio** или **Positron IDE**.
* **Rtools** (только для пользователей **Windows**) — необходим для сборки пакета при установке из исходного кода.

## Установка

Установите актуальную версию пакета напрямую из GitHub репозитория:

```r
if (!require("remotes")) install.packages("remotes")
remotes::install_github("tem19/yaf")
```

## Авторизация и безопасность

Пакет использует официальный протокол OAuth2.

### Как это работает:

1. При первом вызове функции `yaf_get_report("ваш_логин")` и других откроется браузер.

2. Яндекс попросит вас разрешить доступ приложению и покажет токен в окне браузера.

3. Скопируйте токен в браузере, вставьте в консоли Rstudio и нажмите Enter.

4. После ввода кода в консоль R, пакет создаст файл токена с расширением `.rds`.

### Где хранится токен?

Токен сохраняется локально на вашем компьютере в специальную системную папку. Пакет автоматически определяет путь в зависимости от операционной системы:

- macOS: `~/Library/Application Support/yaf/`

- Windows: `C:\Users\ИмяПользователя\AppData\Local\yaf\config\`

При каждом следующем запуске пакет будет сам искать токен в этой папке. Вам не придется проходить авторизацию повторно, пока срок действия токена не истечет (обычно 1 год).

Вы можете узнать точный путь к папке с токенами на вашем ПК командой в консоли R:

`tools::R_user_dir("yaf", "config")`

## yaf_get_report() - Выгрузка статистики
Данная функция предназначена для выгрузки отчетов по рекламным кампаниям. У нее только 1 обязательный параметр - логин в Директе. В таком случае будут выгружены поля Date, Impressions и Clicks за 7 последних дней.  

Пример:
```
library(yaf)
yaf_get_report("your_yandex_login")
```

### Необязательные параметры
`date_from` - начальная дата в выгрузке в формате YYYY-MM-DD
`date_to` - конечная дата в вугрузке в формате YYYY-MM-DD
fields
goals
atribution
filter
search_query_report
numeric_fields_as_numeric

### Пример использования

Пример скрипта для выгрузки отчета:

```
library(yaf)
library(dplyr)

# 1. Авторизация 
# Токен подтянется автоматически, если он уже был сохранен на диске ранее
my_login <- "your_yandex_login"
yaf_get_token(my_login)

# 2. Получение отчета за последние 30 дней
# По умолчанию выгружаются поля: Date, CampaignName, Impressions, Clicks, Cost
stats <- yaf_get_report(
  login = my_login,
  date_from = Sys.Date() - 30,
  date_to = Sys.Date() - 1
)
```
### Получение доступных полей отчета
Код `data(yaf_fields_info)` позволяет выгрузить таблицу со всеими полями, которые можно использовать при обращении к API.

### Поддержка
По любым вопросам можно написать в группу в Телеграме:  
[![](https://img.shields.io/badge/Telegram-Group-blue?logo=telegram)](https://t.me/yaf_group)
