
# yaf <img src="man/figures/logo.png" align="right" height="139" />

Пакет `yaf` (Yandex Direct API Functions) предназначен для простой и быстрой
выгрузки статистики из API Яндекс.Директа напрямую в R. Пакет берет на
себя все сложности с авторизацией, обработкой JSON-ответов и
автоматическим преобразованием типов данных.

## Требования

Для стабильной работы пакета вам понадобятся: \* **R** версии 4.1.0 или
выше (пакет использует нативный пайп `|>`). \* **RStudio** или
**Positron IDE**. \* **Rtools** (только для пользователей **Windows**) —
необходим для сборки пакета при установке из исходного кода.

## Установка

Установите актуальную версию пакета напрямую из GitHub репозитория:

``` r
if (!require("remotes")) install.packages("remotes")
remotes::install_github("tem19/yaf")
```

## Авторизация и безопасность

Пакет использует официальный протокол OAuth2.

### Как это работает:

1.  При первом вызове функции `yaf_get_token("ваш_логин")` откроется
    браузер.

2.  Яндекс попросит вас разрешить доступ приложению и пришлет код
    подтверждения (может потребоваться СМС).

3.  После ввода кода в консоль R, пакет создаст защищенный файл токена с
    расширением `.rds`.

### Где хранится токен?

Токен сохраняется локально на вашем компьютере в специальную системную
папку. Пакет автоматически определяет путь в зависимости от операционной
системы:

- macOS: `~/Library/Application Support/yaf/`

- Windows: `C:\Users\ИмяПользователя\AppData\Local\yaf\config\`

При каждом следующем запуске пакет будет сам искать токен в этой папке.
Вам не придется проходить авторизацию повторно, пока срок действия
токена не истечет (обычно 1 год).

Вы можете узнать точный путь к папке с токенами на вашем ПК командой в
консоли R:

`tools::R_user_dir("yaf", "config")`

### Пример использования

Пример скрипта для выгрузки отчета:

    library(yaf)
    library(dplyr)

    # 1. Авторизация 
    # Токен подтянется автоматически, если он уже был сохранен на диске ранее
    my_login <- "your_yandex_login"
    yaf_get_token(my_login)

    # 2. Получение отчета за последние 30 дней
    # По умолчанию выгружаются поля: Date, CampaignName, Impressions, Clicks, Cost
    stats <- yaf_get_report(
      login = my_login,
      date_from = Sys.Date() - 30,
      date_to = Sys.Date() - 1
    )

    # 3. Анализ данных средствами dplyr
    stats_summary <- stats |> 
      group_by(CampaignName) |> 
      summarise(
        total_clicks = sum(Clicks),
        total_cost = sum(Cost),
        ctr = total_clicks / sum(Impressions) * 100
      ) |> 
      filter(total_clicks > 0)

    print(stats_summary)

    ### Получени доступных полей отчета
    Функция `yaf_fields_info` позволяет выгрузить таблицу со всеими полями, которы можно использовать при обращении к API.
